(()=>{"use strict";function e(e){let t=e.split("="),i=t[0].split("."),o=t.length>1?t.filter(((e,t)=>0!=t)).join("="):"";i[0]=i[0].split("").filter((e=>" "!=e)).join("");let s=""==i[0]?"div":i[0],r=i.filter(((e,t)=>0!=t)),n=document.createElement(s);return r=r.map((e=>e.split("").filter((e=>" "!=e)).join(""))),r.forEach((e=>{n.classList.add(e)})),n.innerHTML=o,n}function t(){if(0==arguments.length)return e("");let t=1==arguments.length?arguments[0]:[...arguments],i=[];return t.forEach((t=>{i.push(e(t))})),1==i.length?i[0]:i}let i={soundOn:!0,easyMode:!1,movies:0,time:0,isStarted:!1,isFinished:!0,gameArray:[],size:4,zeroI:3,zeroJ:3,moviesNode:null,timeNode:null,sizeNode:null,setFields(e,t,i){this.moviesNode=e,this.timeNode=t,this.sizeNode=i},setMovies(e){this.moviesNode.innerHTML=e,this.movies=e},setTime(e){this.time=e;let t=Math.trunc(e/60),i=Math.trunc(e%60),o=(t>9?t:"0"+t)+":"+(i>9?i:"0"+i);this.timeNode.innerHTML=o},start(e){v(),console.log(i),this.isFinished?(e(),this.setTime(0),this.setMovies(0),this.isStarted=!0,this.isFinished=!1):this.isStarted=!0},stop(){v(),this.isStarted=!1},setSize(e,t){v(),this.sizeNode.innerHTML=`Frame size: ${e}x${e}`,this.size=e,this.zeroI=e-1,this.zeroJ=e-1,this.stop(),this.setTime(0),this.setMovies(0),this.isFinished=!0,this.setNewGameArray(),t()},setNewGameArray(){let e=0;this.gameArray=[];for(let t=0;t<this.size;t++){this.gameArray.push(new Array(this.size));for(let i=0;i<this.size;i++)e++,this.gameArray[t][i]=e!=this.size**2?e:0}},moveUp(e,t=!1){if(!this.isStarted&&!t)return!1;if(this.zeroI==this.size-1)return!1;b();let o=this.gameArray[this.zeroI+1][this.zeroJ];return this.gameArray[this.zeroI][this.zeroJ]=o,this.zeroI++,this.gameArray[this.zeroI][this.zeroJ]=0,i.isStarted&&this.setMovies(this.movies+1),e(),h(),!0},moveDown(e,t=!1){if(!this.isStarted&&!t)return!1;if(0==this.zeroI)return!1;b();let o=this.gameArray[this.zeroI-1][this.zeroJ];return this.gameArray[this.zeroI][this.zeroJ]=o,this.zeroI--,this.gameArray[this.zeroI][this.zeroJ]=0,i.isStarted&&this.setMovies(this.movies+1),e(),h(),!0},moveLeft(e,t=!1){if(!this.isStarted&&!t)return!1;if(this.zeroJ==this.size-1)return!1;b();let o=this.gameArray[this.zeroI][this.zeroJ+1];return this.gameArray[this.zeroI][this.zeroJ]=o,this.zeroJ++,this.gameArray[this.zeroI][this.zeroJ]=0,i.isStarted&&this.setMovies(this.movies+1),e(),h(),!0},moveRight(e,t=!1){if(!this.isStarted&&!t)return!1;if(0==this.zeroJ)return!1;b();let o=this.gameArray[this.zeroI][this.zeroJ-1];return this.gameArray[this.zeroI][this.zeroJ]=o,this.zeroJ--,this.gameArray[this.zeroI][this.zeroJ]=0,i.isStarted&&this.setMovies(this.movies+1),e(),h(),!0}};i.setNewGameArray();let o=document.body;function s(o){let s=e(".game-field"),r=(e(".game-field__wrapper"),[]);for(let e=0;e<i.size;e++)for(let t=0;t<i.size;t++){let o=`.game-field__boun .game-field__${i.gameArray[e][t]}=${0!=i.gameArray[e][t]?i.gameArray[e][t]:""}`;r.push(o)}t(r).forEach((e=>s.appendChild(e))),o.appendChild(s)}function r(){let e=document.createElement("style"),t="",o="@media screen and (max-width: 640px) {";for(let e=0;e<i.size;e++)for(let s=0;s<i.size;s++)t+=`.game-field__pos-${e+1}-${s+1}{\n                top: ${65*e+5}px; \n                left: ${65*s+5}px;\n              } `,o+=`.game-field__pos-${e+1}-${s+1}{\n                top: ${45*e+5}px;\n                left: ${45*s+5}px;\n              } `;t+=`.game-field{\n        height: calc(65px * ${i.size} + 5px);\n        width: calc(65px * ${i.size} + 5px);\n    }`,o+=`\n        .game-field{\n            height: calc(45px * ${i.size} + 5px);\n            width: calc(45px * ${i.size} + 5px);\n        }\n    }`,e.innerHTML=t+"\n"+o,document.getElementsByTagName("head")[0].appendChild(e)}function n(){for(let e=0;e<i.size;e++)for(let t=0;t<i.size;t++){const o=`.game-field__${i.gameArray[e][t]}`,s=document.querySelector(o);s.classList.value=s.classList.value.split(" ").filter((e=>!e.includes("__pos"))).join(" "),s.classList.add(`game-field__pos-${e+1}-${t+1}`),s.onclick=null,e==i.zeroI+1&&t==i.zeroJ&&(s.onclick=e=>i.moveUp(n)),e==i.zeroI-1&&t==i.zeroJ&&(s.onclick=e=>i.moveDown(n)),e==i.zeroI&&t==i.zeroJ+1&&(s.onclick=e=>i.moveLeft(n)),e==i.zeroI&&t==i.zeroJ-1&&(s.onclick=e=>i.moveRight(n))}i.isStarted&&d()&&(function(){if(i.soundOn){m.currentTime=0;try{y.play()}catch(e){return}}}(),localStorage.removeItem("gameStr"),c("YOU WIN!!!"),function(e){let t=u();t.push(e),localStorage.setItem("score",JSON.stringify(t))}(function(e,t,i){const o=new Date;return{date:o.toLocaleDateString()+" "+o.toLocaleTimeString(),size:e,movies:t,time:i}}(i.size,i.movies,i.time)),i.stop(),i.isFinished=!0)}function a(){const e=document.querySelector(".game-field");e.innerHTML="",r(),s(e),n()}function l(){!function(){if(i.soundOn){m.currentTime=0;try{z.play()}catch(e){return}}}();const e=i.easyMode?6:Math.trunc(50*Math.random()+50)*i.size;for(let t=0;t<e;t++){const e=Math.trunc(4*Math.random()+1);1===e&&i.moveUp(n,!0),2===e&&i.moveDown(n,!0),3===e&&i.moveLeft(n,!0),4===e&&i.moveRight(n,!0)}d()&&l()}function c(t){const i=e(".win-modal.hiding"),s=e(`.win-message=${t}`);i.appendChild(s),o.appendChild(i),setTimeout((()=>{i.classList.remove("hiding")}),10),setTimeout((()=>{i.classList.add("hiding")}),3e3),setTimeout((()=>{o.removeChild(i)}),3600)}function d(){return i.gameArray.flat().reduce(((e,t,o)=>e&&(t==o+1||0==t&&o==i.size**2-1)),!0)}function u(){const e=localStorage.getItem("score");return e?JSON.parse(e):[]}function h(){document.querySelectorAll(".game-field__boun").forEach((e=>{e.setAttribute("draggable",!1)}));const e=i.zeroI+1,t=i.zeroJ+1,o=document.querySelector(`.game-field__pos-${e}-${t}`),s=document.querySelector(`.game-field__pos-${e-1}-${t}`),r=document.querySelector(`.game-field__pos-${e+1}-${t}`),a=document.querySelector(`.game-field__pos-${e}-${t-1}`),l=document.querySelector(`.game-field__pos-${e}-${t+1}`);let c=0;o.ondrop=function(e){console.log("DROP:",c),1===c&&i.moveDown(n),2===c&&i.moveUp(n),3===c&&i.moveRight(n),4===c&&i.moveLeft(n)},o.ondragover=e=>{e.preventDefault()},new Array(s,r,a,l).forEach(((e,t)=>{e&&(e.setAttribute("draggable",!0),e.ondragstart=i=>{c=t+1,setTimeout((()=>{e.classList.add("display-none")}),1)},e.ondrag=e=>{e.preventDefault()},e.ondragend=t=>{setTimeout((()=>{e.classList.remove("display-none"),c=0}),10)})}))}!function(){let r=e(".game-block");(function(i){let o=e(".buttons-up-block");t("button .up-button .start-button =Start","button .up-button .stop-button =Stop","button .up-button .save-button =Save","button .up-button .results-button =Result","button .up-button .sound-button").forEach((e=>o.appendChild(e))),i.appendChild(o)})(r),function(i){let o=e(".state-block"),s=e(".movies-wrapper"),r=e(".time-wrapper");t(".movies-tittle=Movies:",".movies-count=0").forEach((e=>{s.appendChild(e)})),t(".time-tittle=Time:",".time-count=00:00").forEach((e=>{r.appendChild(e)})),o.appendChild(s),o.appendChild(r),i.appendChild(o)}(r),s(r),function(t){let i=e(".current-size=Frame size: 4x4");t.appendChild(i)}(r),function(i){let o=e(".other-size-wrapper");t(".other-size-title=Other sizes: ","a.other-size-3=3x3","a.other-size-4=4x4","a.other-size-5=5x5","a.other-size-6=6x6","a.other-size-7=7x7","a.other-size-8=8x8").forEach((e=>o.appendChild(e))),i.appendChild(o)}(r),function(t){let o=e("p.text-to-rev=Эта кнопочка для тестирования, если ее активировать, рандом будет менее злой и можно будет легко и быстро собрать пазл.<br>З.Ы.: Все для удобства ревьювера!"),s=e("button .up-button .easy-button =Easy mode (off)");t.appendChild(o),s.onclick=()=>{v(),s.classList.toggle("easy-button_active"),i.easyMode=!i.easyMode,s.textContent=`Easy mode (${i.easyMode?"on":"off"})`},t.appendChild(s)}(r),o.appendChild(r)}(),i.setFields(document.querySelector(".movies-count"),document.querySelector(".time-count"),document.querySelector(".current-size")),r(),document.querySelector(".other-size-3").onclick=()=>{i.setSize(3,a)},document.querySelector(".other-size-4").onclick=()=>{i.setSize(4,a)},document.querySelector(".other-size-5").onclick=()=>{i.setSize(5,a)},document.querySelector(".other-size-6").onclick=()=>{i.setSize(6,a)},document.querySelector(".other-size-7").onclick=()=>{i.setSize(7,a)},document.querySelector(".other-size-8").onclick=()=>{i.setSize(8,a)},n(),document.querySelector(".start-button").onclick=()=>i.start(l),document.querySelector(".stop-button").onclick=()=>i.stop(),setInterval((()=>{i.isStarted&&i.setTime(i.time+1)}),1e3),document.querySelector(".results-button").onclick=()=>function(i,s){v();const r=e(".win-modal.hiding"),n=e(".score-block"),a=e(".score-block__wrapper"),l=e(".score-block__title=RESULT"),c=e(".score-block__grid");(function(e,i){t(".grid-header=DATE",".grid-header=SIZE",".grid-header=TIME",".grid-header=MOVIES").forEach((t=>e.appendChild(t)));let o=i();o=o.sort(((e,t)=>e.time-t.time)),o.forEach((i=>{const o=Math.trunc(i.time/60),s=Math.trunc(i.time%60),r=(o>9?o:"0"+o)+":"+(s>9?s:"0"+s);t(`.grid-element=${i.date}`,`.grid-element=${i.size}x${i.size}`,`.grid-element=${r}`,`.grid-element=${i.movies}`).forEach((t=>e.appendChild(t)))}))})(c,s),n.appendChild(l),a.appendChild(c),n.appendChild(a),r.appendChild(n),o.appendChild(r),setTimeout((()=>{r.classList.remove("hiding")}),10),r.onclick=e=>{e.srcElement==r&&(setTimeout((()=>{r.classList.add("hiding")}),30),setTimeout((()=>{o.removeChild(r)}),630))}}(0,u),h();const m=new Audio("src/assets/sound/button.mp3"),p=new Audio("src/assets/sound/message.mp3"),z=new Audio("src/assets/sound/shufle.mp3"),f=new Audio("src/assets/sound/switch-1.mp3"),g=new Audio("src/assets/sound/switch-2.mp3"),y=new Audio("src/assets/sound/victory.mp3");let S=!0;function v(){if(i.soundOn){m.currentTime=0;try{m.play()}catch(e){return}}}function b(){if(i.soundOn){try{S?f.play():g.play()}catch(e){return}S=!S}}document.querySelector(".sound-button").onclick=function(e){this.classList.toggle("sound-button_off"),i.soundOn=!i.soundOn},document.querySelector(".save-button").onclick=function(){let e=JSON.stringify({soundOn:i.soundOn,isFinished:i.isFinished,movies:i.movies,time:i.time,size:i.size,gameArray:JSON.stringify(i.gameArray),zeroI:i.zeroI,zeroJ:i.zeroJ,isStarted:i.isStarted});localStorage.setItem("gameStr",e),c("Progress saved! It will load automaticly after loading game!"),function(){if(i.soundOn){p.currentTime=0;try{p.play()}catch(e){return}}}()},function(){let e=localStorage.getItem("gameStr");if(e){const t=JSON.parse(e);i.setSize(t.size,a),i.soundOn=t.soundOn,i.isFinished=t.isFinished,i.setMovies(t.movies),i.setTime(t.time),i.gameArray=JSON.parse(t.gameArray),i.zeroI=t.zeroI,i.zeroJ=t.zeroJ,t.isStarted&&i.start((()=>{})),n(),h()}}()})();